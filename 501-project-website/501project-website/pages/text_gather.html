<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid">
      <a class="navbar-brand" href="../index.html">ANLY501</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarColor02" aria-controls="navbarColor02" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarColor02">
        <ul class="navbar-nav me-auto">
          <li class="nav-item">
            <a class="nav-link" href="https://github.com/anly501/anly-501-project-liumingqian0511/tree/main/codes">Code</a>
          </li>
          <!-- Introduction -->
          <li class="nav-item">
            <a class="nav-link" href="./introduction00.html">Introduction</a>
          </li>
          <!-- Data Gathering -->
          <li class="nav-item">
            <a class="nav-link" href="./text_gather.html">Data Gathering</a>
          </li>
          <!-- Record Data -->
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Record Data</a>
            <div class="dropdown-menu">
              <a class="dropdown-item" href="./record_data_cleaning.html">Cleaning</a>
              <a class="dropdown-item" href="./Record_Data_Exploring.html">Exploring</a>
            </div>
          </li>
          <!-- Text Data -->
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Text Data</a>
            <div class="dropdown-menu">
              <a class="dropdown-item" href="./text_clean.html">Cleaning</a>
              <a class="dropdown-item" href="./text_data_explore.html">Exploring</a>
            </div>
          </li>
          <!-- NB -->
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Naive Bayes</a>
            <div class="dropdown-menu">
              <a class="dropdown-item" href="./record_NB.html">Record data</a>
              <a class="dropdown-item" href="./textNB.html">Text data</a>
            </div>
          </li>
          <!-- Classification -->
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Classification</a>
            <div class="dropdown-menu">
              <a class="dropdown-item" href="./decision_tree.html">Decision Tree</a>
              <a class="dropdown-item" href="./svm_text.html">SVM</a>
            </div>
          </li>
          <!-- Clustering -->
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Clustering</a>
            <div class="dropdown-menu">
              <a class="dropdown-item" href="./intro_cluster.html">Intro & Theory</a>
              <a class="dropdown-item" href="./Methods_page.html">Method & Result</a>
              <a class="dropdown-item" href="./Conlusion.html">Conclusion</a>
            </div>
          </li>
          <!-- ARM -->
          <li class="nav-item">
            <a class="nav-link" href="./arm.html">ARM</a>
          </li>
          <!-- Conclusion -->
          <li class="nav-item">
            <a class="nav-link" href="./conclusion00.html">Conclusion</a>
          </li>
          <!-- Data -->
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Data</a>
            <div class="dropdown-menu">
              <a class="dropdown-item" href="#">Raw</a>
              <a class="dropdown-item" href="#">Modified</a>
            </div>
          </li>
        </ul>
      </div>
    </div>
  </nav>
<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.251">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2022-11-29">

<title>Text Data Gathering</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="text_gather_files/libs/clipboard/clipboard.min.js"></script>
<script src="text_gather_files/libs/quarto-html/quarto.js"></script>
<script src="text_gather_files/libs/quarto-html/popper.min.js"></script>
<script src="text_gather_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="text_gather_files/libs/quarto-html/anchor.min.js"></script>
<link href="text_gather_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="text_gather_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="text_gather_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="text_gather_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="text_gather_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contents</h2>
   
  <ul>
  <li><a href="#text-data-and-api" id="toc-text-data-and-api" class="nav-link active" data-scroll-target="#text-data-and-api">Text data and API</a>
  <ul class="collapse">
  <li><a href="#twitter-api" id="toc-twitter-api" class="nav-link" data-scroll-target="#twitter-api">Twitter API</a></li>
  <li><a href="#wikipedia" id="toc-wikipedia" class="nav-link" data-scroll-target="#wikipedia">Wikipedia</a></li>
  <li><a href="#record-data" id="toc-record-data" class="nav-link" data-scroll-target="#record-data">Record Data</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Text Data Gathering</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">November 29, 2022</p>
    </div>
  </div>
    
  </div>
  

</header>

<div class="cell" data-execution_count="1">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> csv</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tqdm <span class="im">import</span> tqdm</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tweepy</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> wikipedia</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> wordcloud <span class="im">import</span> WordCloud, STOPWORDS</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="text-data-and-api" class="level2">
<h2 class="anchored" data-anchor-id="text-data-and-api">Text data and API</h2>
<p>Text analysis is crucial in the data science field. It is the process of extracting meaning from text. For example, this can be analyzing text written by customers in a customer survey, with a focus on finding common themes and trends. The idea is to be able to examine the customer feedback to inform the business on taking strategic action, in order to improve customer experience. In this section, I will show you the steps for gathering text data that is related to my topic using Twitter API and Wikipedia API. Before we gather data, let’s first introduce you to API.</p>
<p><strong>What is API?</strong></p>
<p>I am going to explain API using a simple and non-IT-related example. When you go to a restaurant and order some food, you will interact with the waiter. You can order food, and drink, ask for a menu, request bills, and so on. You do not have to worry about stoves, dishes, or ovens because in this case, the waiter is shielding you from all the complicated stuff that happens behind the scenes. The waiter will be an interface between you and all the services that the restaurant offers. In a way, the waiter can be seen as the API of the restaurant in this example.</p>
<p>The term API stands for Application Programmable Interface, it is a way for different programs to work together in various ways. There are many types of APIs and reasons why they are used, but in this project, the main function of API is to get access to data from third parties.</p>
<section id="twitter-api" class="level3">
<h3 class="anchored" data-anchor-id="twitter-api">Twitter API</h3>
<p>I decided to use the Twitter API to gather the first text data on health insurance. The output data is mainly tweeted from users. I think the most intuitive and objective way to get users’ feedback on the insurance industry is to collect their direct comments about it on their social platforms. The first step to accessing the data from a third party is always getting authentication from it. For Twitter API, I registered a development account and received my own access key and tokens. This will link my usage of data to the account and store my project. Next, I defined the search_twitter function to customize the features of data to gather including keywords, max_results, language, and so on.</p>
<p>Since I am curious about the health insurance industry, I decided to gather tweets with the most popular health insurance brand name in them. Thus, the list I created to search tweets includes ‘UnitedHealth’,‘ Anthem’,‘ Aetna’, ‘Cigna’, and ‘Humana’.</p>
<div class="cell" data-execution_count="2">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>consumer_key <span class="op">=</span> <span class="st">'Yf97lN35cmpNjqvs4YloK5bgj'</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>consumer_secret <span class="op">=</span> <span class="st">'gtx7aYcUfP8xR4UcSP53h7HkVnq8oUnn3hQgH24tKmMPJ9wZlw'</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>access_token <span class="op">=</span> <span class="st">'1453449116302860297-8CBLV2AMCBbMQcmzyzxr9beZo03EkU'</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>access_token_secret <span class="op">=</span> <span class="st">'ll1zMrp5eaTOxLYXrO8lhaph7IL4paJ4PjAdkrri6ILKY'</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>bearer_token <span class="op">=</span> <span class="st">'AAAAAAAAAAAAAAAAAAAAABVsegEAAAAASKd3LMyDMSW7bO6pWA0iF9R23cM%3DsCTiS4uKWVzw9tqUhmvD5NDL6zbnd2NCO5BK66jcG3uanmxz6D'</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co">#| id: yUr7fbzp3Pyv</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co">#| id: yUr7fbzp3Pyv</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Authenticate to Twitter</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>auth <span class="op">=</span> tweepy.OAuthHandler(consumer_key, consumer_secret)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>auth.set_access_token(access_token, access_token_secret)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>api <span class="op">=</span> tweepy.API(auth) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="3">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define search_twitter function</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> search_twitter(query, max_results,tweet_fields, bearer_token <span class="op">=</span> bearer_token):</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    headers <span class="op">=</span> {<span class="st">"Authorization"</span>: <span class="st">"Bearer </span><span class="sc">{}</span><span class="st">"</span>.<span class="bu">format</span>(bearer_token)}</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    url <span class="op">=</span> <span class="st">"https://api.twitter.com/2/tweets/search/recent?query=</span><span class="sc">{}</span><span class="st">&amp;max_results=</span><span class="sc">{}</span><span class="st">&amp;</span><span class="sc">{}</span><span class="st">"</span>.<span class="bu">format</span>(query, max_results,tweet_fields)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"--------------"</span>,url,<span class="st">"--------------"</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> requests.request(<span class="st">"GET"</span>, url, headers<span class="op">=</span>headers)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> response.status_code <span class="op">!=</span> <span class="dv">200</span>:</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">Exception</span>(response.status_code, response.text)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> response.json()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-outputid="9eb2aab7-955b-40b9-e7b4-0341e4bc2b2b" data-execution_count="4">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>tweet_fields <span class="op">=</span> <span class="st">"tweet.fields=text,author_id,created_at,lang"</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>search_tweets <span class="op">=</span> [<span class="st">'UnitedHealth'</span>,<span class="st">'Anthem'</span>,<span class="st">'Aetna'</span>,<span class="st">'Cigna'</span>,<span class="st">'Humana'</span>]</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx,val <span class="kw">in</span> <span class="bu">enumerate</span>(search_tweets):</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    tweets_jsondump <span class="op">=</span> []</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    json_response1 <span class="op">=</span> search_twitter(query <span class="op">=</span> <span class="bu">str</span>(val), max_results <span class="op">=</span> <span class="dv">100</span>, tweet_fields <span class="op">=</span> tweet_fields, bearer_token<span class="op">=</span>bearer_token)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    json_response2 <span class="op">=</span> search_twitter(query <span class="op">=</span> <span class="bu">str</span>(val), max_results <span class="op">=</span> <span class="dv">100</span>, tweet_fields <span class="op">=</span> tweet_fields, bearer_token<span class="op">=</span>bearer_token)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    json_response3 <span class="op">=</span> search_twitter(query <span class="op">=</span> <span class="bu">str</span>(val), max_results <span class="op">=</span> <span class="dv">100</span>, tweet_fields <span class="op">=</span> tweet_fields, bearer_token<span class="op">=</span>bearer_token)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> json_response1[<span class="st">'data'</span>]:</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>        tweets_jsondump.append(i)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> json_response2[<span class="st">'data'</span>]:</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>        tweets_jsondump.append(i)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> json_response3[<span class="st">'data'</span>]:</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>        tweets_jsondump.append(i)</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(<span class="bu">str</span>(val)<span class="op">+</span><span class="st">'.json'</span>,<span class="st">'w'</span>) <span class="im">as</span> json_file:</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>        json.dump(tweets_jsondump,json_file)</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>        json_file.close()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>json_files <span class="op">=</span> [pos_json <span class="cf">for</span> pos_json <span class="kw">in</span> os.listdir(<span class="st">'./'</span>) <span class="cf">if</span> pos_json.endswith(<span class="st">'.json'</span>)]</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(json_files) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>['Humana.json', 'Cigna.json', 'UnitedHealth.json', 'Anthem.json', 'Aetna.json']</code></pre>
</div>
</div>
<p>Finally from the Twitter API I got five JSON files named by different insurance brands. For a simple demonstration, I converted them into data frames and searched them for high-frequency words that I thought might appear, including ‘covid’,‘vaccine’,‘policy’, etc. A simple word frequency table and its corresponding barplot are presented below.</p>
<div class="cell" data-outputid="50b8eb40-bec7-4785-a1d0-c79f4d75d133" data-execution_count="6">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>tweet_fields <span class="op">=</span> <span class="st">"tweet.fields=text,author_id,created_at,lang"</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>search_tweets <span class="op">=</span> [<span class="st">'covid'</span>,<span class="st">'vaccine'</span>,<span class="st">'policy'</span>,<span class="st">'health'</span>,<span class="st">'doctor'</span>,<span class="st">'patients'</span>,<span class="st">'insurance'</span>,<span class="st">'cover'</span>,<span class="st">'medicaid'</span>,<span class="st">'medicare'</span>]</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co">#client = tweepy.Client(bearer_token)</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame({<span class="st">'words'</span>:search_tweets,<span class="st">'count'</span>:[<span class="dv">0</span>]<span class="op">*</span><span class="dv">10</span>})</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, val <span class="kw">in</span> <span class="bu">enumerate</span>(json_files):</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    open_json <span class="op">=</span> <span class="bu">open</span>(<span class="st">'./'</span><span class="op">+</span>val)</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    load_json <span class="op">=</span> json.load(open_json)</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    df_tweet <span class="op">=</span> pd.DataFrame(load_json)</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> word <span class="kw">in</span> search_tweets:</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(df_tweet.text)): </span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> word <span class="kw">in</span> df_tweet[<span class="st">'text'</span>][i]:<span class="co"># condition satisfied?</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>                df.loc[df[<span class="st">'words'</span>]<span class="op">==</span>word,<span class="st">'count'</span>] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> df.sort_values(<span class="st">'count'</span>).plot(x <span class="op">=</span> <span class="st">'words'</span>,y<span class="op">=</span><span class="st">'count'</span>,kind<span class="op">=</span><span class="st">'bar'</span>)</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Frequency of Words'</span>)</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'word'</span>)</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Count'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>       words  count
0      covid      0
1    vaccine      0
2     policy      3
3     health     90
4     doctor     12
5   patients      9
6  insurance     51
7      cover     21
8   medicaid      0
9   medicare      0</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>Text(0, 0.5, 'Count')</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="text_gather_files/figure-html/cell-7-output-3.png" width="585" height="502"></p>
</div>
</div>
</section>
<section id="wikipedia" class="level3">
<h3 class="anchored" data-anchor-id="wikipedia">Wikipedia</h3>
<p>In addition, I used the Wikipedia API to collect the top 10 web pages that appeared on the site when I searched for the word “health insurance”. I saved all the text on this web page into a list called mytext and generated a word cloud poster below. The results are obvious: the most popular words on word cloud are related to insurance and disease.</p>
<div class="cell" data-execution_count="7">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>keywords <span class="op">=</span> wikipedia.search(<span class="st">"health insurance"</span>, results<span class="op">=</span><span class="dv">10</span>, suggestion<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>my_text <span class="op">=</span> <span class="st">''</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> keywords:</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    page <span class="op">=</span> wikipedia.page(title <span class="op">=</span> k)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    content <span class="op">=</span> page.content</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    my_text <span class="op">+=</span> content</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    text_file <span class="op">=</span> <span class="bu">open</span>(k<span class="op">+</span><span class="st">'.txt'</span>, <span class="st">"w"</span>)</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> text_file.write(content)</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>    text_file.close()</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>wordcloud <span class="op">=</span> WordCloud(</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>    width <span class="op">=</span> <span class="dv">3000</span>,</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>    height <span class="op">=</span> <span class="dv">2000</span>, </span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>    random_state<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>    background_color<span class="op">=</span><span class="st">'salmon'</span>, </span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>    colormap<span class="op">=</span><span class="st">'Pastel1'</span>, </span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>    collocations<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>    stopwords <span class="op">=</span> STOPWORDS).generate(my_text)</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>plt.imshow(wordcloud) </span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">"off"</span>)</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="text_gather_files/figure-html/cell-8-output-1.png" width="763" height="515"></p>
</div>
</div>
</section>
<section id="record-data" class="level3">
<h3 class="anchored" data-anchor-id="record-data">Record Data</h3>
<p>For record data, I will use two datasets from the RAND Health Insurance Experiment (HIE). One contains demographic information about the subjects in the study and also health variables (outcomes) both before and after the experiment. The other file has information about health care spending. Both dataset consists of 319 variables and 20203 observations. From 1974 to 1982, the RAND Health Insurance Experiment followed 3,958 people aged 14 to 61 from six areas of the country. The participants were randomly assigned to one of 14 insurance plans that had a variety of provisions related to cost-sharing. Besides the variable “plantype”, which identifies the assigned insurance group of each individual, the variables that I am going to use for this project are displayed below:</p>
<table class="table">
<thead>
<tr class="header">
<th>Variable</th>
<th>Definition</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>female</td>
<td>Female</td>
</tr>
<tr class="even">
<td>blackhisp</td>
<td>Nonwhite</td>
</tr>
<tr class="odd">
<td>age</td>
<td>Age</td>
</tr>
<tr class="even">
<td>educper</td>
<td>Education</td>
</tr>
<tr class="odd">
<td>income1cpi</td>
<td>Family income</td>
</tr>
<tr class="even">
<td>hosp</td>
<td>Hospitalized last year</td>
</tr>
<tr class="odd">
<td>ghindx</td>
<td>General Health Index (before)</td>
</tr>
<tr class="even">
<td>cholest</td>
<td>Cholesterol (mg/dl) (before)</td>
</tr>
<tr class="odd">
<td>systol</td>
<td>Systolic blood pressure (mm Hg) (before)</td>
</tr>
<tr class="even">
<td>mhi</td>
<td>Mental Health Index (before)</td>
</tr>
<tr class="odd">
<td>ghindxx</td>
<td>General Health Index (after)</td>
</tr>
<tr class="even">
<td>cholestx</td>
<td>Cholesterol (mg/dl) (after)</td>
</tr>
<tr class="odd">
<td>systolx</td>
<td>Systolic blood pressure (mm Hg) (after)</td>
</tr>
<tr class="even">
<td>mhix</td>
<td>Mental Health Index (after)</td>
</tr>
</tbody>
</table>
<!-- -->

</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb26" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="an">jupyter:</span><span class="co"> python3</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Text Data Gathering"</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "11/29/2022"</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="an">pdf-engine:</span><span class="co"> lualatex</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="co">    theme : Minty</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a><span class="co">    code-summary: "Code"</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-title: Contents</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a><span class="co">    warning: false</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a><span class="co">#| id: kougMyICtNx2</span></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a><span class="co">#| id: kougMyICtNx2</span></span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> csv</span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tqdm <span class="im">import</span> tqdm</span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tweepy</span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> wikipedia</span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> wordcloud <span class="im">import</span> WordCloud, STOPWORDS</span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true" tabindex="-1"></a><span class="fu">## Text data and API </span></span>
<span id="cb26-40"><a href="#cb26-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-41"><a href="#cb26-41" aria-hidden="true" tabindex="-1"></a>Text analysis is crucial in the data science field. It is the process of extracting meaning from text. For example, this can be analyzing text written by customers in a customer survey, with a focus on finding common themes and trends. The idea is to be able to examine the customer feedback to inform the business on taking strategic action, in order to improve customer experience. In this section, I will show you the steps for gathering text data that is related to my topic using Twitter API and Wikipedia API. Before we gather data, let’s first introduce you to API.</span>
<span id="cb26-42"><a href="#cb26-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-43"><a href="#cb26-43" aria-hidden="true" tabindex="-1"></a>**What is API?**</span>
<span id="cb26-44"><a href="#cb26-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-45"><a href="#cb26-45" aria-hidden="true" tabindex="-1"></a>I am going to explain API using a simple and non-IT-related example. When you go to a restaurant and order some food, you will interact with the waiter. You can order food, and drink, ask for a menu, request bills, and so on. You do not have to worry about stoves, dishes, or ovens because in this case, the waiter is shielding you from all the complicated stuff that happens behind the scenes. The waiter will be an interface between you and all the services that the restaurant offers. In a way, the waiter can be seen as the API of the restaurant in this example.</span>
<span id="cb26-46"><a href="#cb26-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-47"><a href="#cb26-47" aria-hidden="true" tabindex="-1"></a>The term API stands for Application Programmable Interface, it is a way for different programs to work together in various ways. There are many types of APIs and reasons why they are used, but in this project, the main function of API is to get access to data from third parties.</span>
<span id="cb26-48"><a href="#cb26-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-49"><a href="#cb26-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-50"><a href="#cb26-50" aria-hidden="true" tabindex="-1"></a><span class="fu">### Twitter API</span></span>
<span id="cb26-51"><a href="#cb26-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-52"><a href="#cb26-52" aria-hidden="true" tabindex="-1"></a>I decided to use the Twitter API to gather the first text data on health insurance. The output data is mainly tweeted from users. I think the most intuitive and objective way to get users’ feedback on the insurance industry is to collect their direct comments about it on their social platforms. The first step to accessing the data from a third party is always getting authentication from it. For Twitter API, I registered a development account and received my own access key and tokens. This will link my usage of data to the account and store my project. Next, I defined the search_twitter function to customize the features of data to gather including keywords, max_results, language, and so on.</span>
<span id="cb26-53"><a href="#cb26-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-54"><a href="#cb26-54" aria-hidden="true" tabindex="-1"></a>Since I am curious about the health insurance industry, I decided to gather tweets with the most popular health insurance brand name in them. Thus, the list I created to search tweets includes ‘UnitedHealth’,‘ Anthem’,‘ Aetna’, ‘Cigna’, and ‘Humana’.</span>
<span id="cb26-55"><a href="#cb26-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-56"><a href="#cb26-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-59"><a href="#cb26-59" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb26-60"><a href="#cb26-60" aria-hidden="true" tabindex="-1"></a><span class="co">#| id: OflI_Jnp3YFc</span></span>
<span id="cb26-61"><a href="#cb26-61" aria-hidden="true" tabindex="-1"></a><span class="co">#| id: OflI_Jnp3YFc</span></span>
<span id="cb26-62"><a href="#cb26-62" aria-hidden="true" tabindex="-1"></a>consumer_key <span class="op">=</span> <span class="st">'Yf97lN35cmpNjqvs4YloK5bgj'</span></span>
<span id="cb26-63"><a href="#cb26-63" aria-hidden="true" tabindex="-1"></a>consumer_secret <span class="op">=</span> <span class="st">'gtx7aYcUfP8xR4UcSP53h7HkVnq8oUnn3hQgH24tKmMPJ9wZlw'</span></span>
<span id="cb26-64"><a href="#cb26-64" aria-hidden="true" tabindex="-1"></a>access_token <span class="op">=</span> <span class="st">'1453449116302860297-8CBLV2AMCBbMQcmzyzxr9beZo03EkU'</span></span>
<span id="cb26-65"><a href="#cb26-65" aria-hidden="true" tabindex="-1"></a>access_token_secret <span class="op">=</span> <span class="st">'ll1zMrp5eaTOxLYXrO8lhaph7IL4paJ4PjAdkrri6ILKY'</span></span>
<span id="cb26-66"><a href="#cb26-66" aria-hidden="true" tabindex="-1"></a>bearer_token <span class="op">=</span> <span class="st">'AAAAAAAAAAAAAAAAAAAAABVsegEAAAAASKd3LMyDMSW7bO6pWA0iF9R23cM%3DsCTiS4uKWVzw9tqUhmvD5NDL6zbnd2NCO5BK66jcG3uanmxz6D'</span></span>
<span id="cb26-67"><a href="#cb26-67" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb26-68"><a href="#cb26-68" aria-hidden="true" tabindex="-1"></a><span class="co">#| id: yUr7fbzp3Pyv</span></span>
<span id="cb26-69"><a href="#cb26-69" aria-hidden="true" tabindex="-1"></a><span class="co">#| id: yUr7fbzp3Pyv</span></span>
<span id="cb26-70"><a href="#cb26-70" aria-hidden="true" tabindex="-1"></a><span class="co"># Authenticate to Twitter</span></span>
<span id="cb26-71"><a href="#cb26-71" aria-hidden="true" tabindex="-1"></a>auth <span class="op">=</span> tweepy.OAuthHandler(consumer_key, consumer_secret)</span>
<span id="cb26-72"><a href="#cb26-72" aria-hidden="true" tabindex="-1"></a>auth.set_access_token(access_token, access_token_secret)</span>
<span id="cb26-73"><a href="#cb26-73" aria-hidden="true" tabindex="-1"></a>api <span class="op">=</span> tweepy.API(auth) </span>
<span id="cb26-74"><a href="#cb26-74" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-75"><a href="#cb26-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-76"><a href="#cb26-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-79"><a href="#cb26-79" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb26-80"><a href="#cb26-80" aria-hidden="true" tabindex="-1"></a><span class="co">#| id: 1UNXJC2L3Szz</span></span>
<span id="cb26-81"><a href="#cb26-81" aria-hidden="true" tabindex="-1"></a><span class="co">#| id: 1UNXJC2L3Szz</span></span>
<span id="cb26-82"><a href="#cb26-82" aria-hidden="true" tabindex="-1"></a><span class="co"># define search_twitter function</span></span>
<span id="cb26-83"><a href="#cb26-83" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> search_twitter(query, max_results,tweet_fields, bearer_token <span class="op">=</span> bearer_token):</span>
<span id="cb26-84"><a href="#cb26-84" aria-hidden="true" tabindex="-1"></a>    headers <span class="op">=</span> {<span class="st">"Authorization"</span>: <span class="st">"Bearer </span><span class="sc">{}</span><span class="st">"</span>.<span class="bu">format</span>(bearer_token)}</span>
<span id="cb26-85"><a href="#cb26-85" aria-hidden="true" tabindex="-1"></a>    url <span class="op">=</span> <span class="st">"https://api.twitter.com/2/tweets/search/recent?query=</span><span class="sc">{}</span><span class="st">&amp;max_results=</span><span class="sc">{}</span><span class="st">&amp;</span><span class="sc">{}</span><span class="st">"</span>.<span class="bu">format</span>(query, max_results,tweet_fields)</span>
<span id="cb26-86"><a href="#cb26-86" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"--------------"</span>,url,<span class="st">"--------------"</span>)</span>
<span id="cb26-87"><a href="#cb26-87" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> requests.request(<span class="st">"GET"</span>, url, headers<span class="op">=</span>headers)</span>
<span id="cb26-88"><a href="#cb26-88" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> response.status_code <span class="op">!=</span> <span class="dv">200</span>:</span>
<span id="cb26-89"><a href="#cb26-89" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">Exception</span>(response.status_code, response.text)</span>
<span id="cb26-90"><a href="#cb26-90" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> response.json()</span>
<span id="cb26-91"><a href="#cb26-91" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-92"><a href="#cb26-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-95"><a href="#cb26-95" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb26-96"><a href="#cb26-96" aria-hidden="true" tabindex="-1"></a><span class="co">#| id: juwDVNTZ3izs</span></span>
<span id="cb26-97"><a href="#cb26-97" aria-hidden="true" tabindex="-1"></a><span class="co">#| colab: {base_uri: 'https://localhost:8080/'}</span></span>
<span id="cb26-98"><a href="#cb26-98" aria-hidden="true" tabindex="-1"></a><span class="co">#| id: juwDVNTZ3izs</span></span>
<span id="cb26-99"><a href="#cb26-99" aria-hidden="true" tabindex="-1"></a><span class="co">#| outputId: 9eb2aab7-955b-40b9-e7b4-0341e4bc2b2b</span></span>
<span id="cb26-100"><a href="#cb26-100" aria-hidden="true" tabindex="-1"></a>tweet_fields <span class="op">=</span> <span class="st">"tweet.fields=text,author_id,created_at,lang"</span></span>
<span id="cb26-101"><a href="#cb26-101" aria-hidden="true" tabindex="-1"></a>search_tweets <span class="op">=</span> [<span class="st">'UnitedHealth'</span>,<span class="st">'Anthem'</span>,<span class="st">'Aetna'</span>,<span class="st">'Cigna'</span>,<span class="st">'Humana'</span>]</span>
<span id="cb26-102"><a href="#cb26-102" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx,val <span class="kw">in</span> <span class="bu">enumerate</span>(search_tweets):</span>
<span id="cb26-103"><a href="#cb26-103" aria-hidden="true" tabindex="-1"></a>    tweets_jsondump <span class="op">=</span> []</span>
<span id="cb26-104"><a href="#cb26-104" aria-hidden="true" tabindex="-1"></a>    json_response1 <span class="op">=</span> search_twitter(query <span class="op">=</span> <span class="bu">str</span>(val), max_results <span class="op">=</span> <span class="dv">100</span>, tweet_fields <span class="op">=</span> tweet_fields, bearer_token<span class="op">=</span>bearer_token)</span>
<span id="cb26-105"><a href="#cb26-105" aria-hidden="true" tabindex="-1"></a>    json_response2 <span class="op">=</span> search_twitter(query <span class="op">=</span> <span class="bu">str</span>(val), max_results <span class="op">=</span> <span class="dv">100</span>, tweet_fields <span class="op">=</span> tweet_fields, bearer_token<span class="op">=</span>bearer_token)</span>
<span id="cb26-106"><a href="#cb26-106" aria-hidden="true" tabindex="-1"></a>    json_response3 <span class="op">=</span> search_twitter(query <span class="op">=</span> <span class="bu">str</span>(val), max_results <span class="op">=</span> <span class="dv">100</span>, tweet_fields <span class="op">=</span> tweet_fields, bearer_token<span class="op">=</span>bearer_token)</span>
<span id="cb26-107"><a href="#cb26-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-108"><a href="#cb26-108" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> json_response1[<span class="st">'data'</span>]:</span>
<span id="cb26-109"><a href="#cb26-109" aria-hidden="true" tabindex="-1"></a>        tweets_jsondump.append(i)</span>
<span id="cb26-110"><a href="#cb26-110" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> json_response2[<span class="st">'data'</span>]:</span>
<span id="cb26-111"><a href="#cb26-111" aria-hidden="true" tabindex="-1"></a>        tweets_jsondump.append(i)</span>
<span id="cb26-112"><a href="#cb26-112" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> json_response3[<span class="st">'data'</span>]:</span>
<span id="cb26-113"><a href="#cb26-113" aria-hidden="true" tabindex="-1"></a>        tweets_jsondump.append(i)</span>
<span id="cb26-114"><a href="#cb26-114" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(<span class="bu">str</span>(val)<span class="op">+</span><span class="st">'.json'</span>,<span class="st">'w'</span>) <span class="im">as</span> json_file:</span>
<span id="cb26-115"><a href="#cb26-115" aria-hidden="true" tabindex="-1"></a>        json.dump(tweets_jsondump,json_file)</span>
<span id="cb26-116"><a href="#cb26-116" aria-hidden="true" tabindex="-1"></a>        json_file.close()</span>
<span id="cb26-117"><a href="#cb26-117" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-118"><a href="#cb26-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-119"><a href="#cb26-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-122"><a href="#cb26-122" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb26-123"><a href="#cb26-123" aria-hidden="true" tabindex="-1"></a><span class="co">#| id: ge-vyJEjPb5h</span></span>
<span id="cb26-124"><a href="#cb26-124" aria-hidden="true" tabindex="-1"></a><span class="co">#| colab: {base_uri: 'https://localhost:8080/'}</span></span>
<span id="cb26-125"><a href="#cb26-125" aria-hidden="true" tabindex="-1"></a><span class="co">#| id: ge-vyJEjPb5h</span></span>
<span id="cb26-126"><a href="#cb26-126" aria-hidden="true" tabindex="-1"></a><span class="co">#| outputId: 6d21d57e-beec-4b24-a847-b0ef23caf575</span></span>
<span id="cb26-127"><a href="#cb26-127" aria-hidden="true" tabindex="-1"></a>json_files <span class="op">=</span> [pos_json <span class="cf">for</span> pos_json <span class="kw">in</span> os.listdir(<span class="st">'./'</span>) <span class="cf">if</span> pos_json.endswith(<span class="st">'.json'</span>)]</span>
<span id="cb26-128"><a href="#cb26-128" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(json_files) </span>
<span id="cb26-129"><a href="#cb26-129" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-130"><a href="#cb26-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-131"><a href="#cb26-131" aria-hidden="true" tabindex="-1"></a>Finally from the Twitter API I got five JSON files named by different insurance brands. For a simple demonstration, I converted them into data frames and searched them for high-frequency words that I thought might appear, including ‘covid’,‘vaccine’,‘policy’, etc. A simple word frequency table and its corresponding barplot are presented below.</span>
<span id="cb26-134"><a href="#cb26-134" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb26-135"><a href="#cb26-135" aria-hidden="true" tabindex="-1"></a><span class="co">#| id: QO7aKBaHPI04</span></span>
<span id="cb26-136"><a href="#cb26-136" aria-hidden="true" tabindex="-1"></a><span class="co">#| colab: {base_uri: 'https://localhost:8080/', height: 538}</span></span>
<span id="cb26-137"><a href="#cb26-137" aria-hidden="true" tabindex="-1"></a><span class="co">#| id: QO7aKBaHPI04</span></span>
<span id="cb26-138"><a href="#cb26-138" aria-hidden="true" tabindex="-1"></a><span class="co">#| outputId: 50b8eb40-bec7-4785-a1d0-c79f4d75d133</span></span>
<span id="cb26-139"><a href="#cb26-139" aria-hidden="true" tabindex="-1"></a>tweet_fields <span class="op">=</span> <span class="st">"tweet.fields=text,author_id,created_at,lang"</span></span>
<span id="cb26-140"><a href="#cb26-140" aria-hidden="true" tabindex="-1"></a>search_tweets <span class="op">=</span> [<span class="st">'covid'</span>,<span class="st">'vaccine'</span>,<span class="st">'policy'</span>,<span class="st">'health'</span>,<span class="st">'doctor'</span>,<span class="st">'patients'</span>,<span class="st">'insurance'</span>,<span class="st">'cover'</span>,<span class="st">'medicaid'</span>,<span class="st">'medicare'</span>]</span>
<span id="cb26-141"><a href="#cb26-141" aria-hidden="true" tabindex="-1"></a><span class="co">#client = tweepy.Client(bearer_token)</span></span>
<span id="cb26-142"><a href="#cb26-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-143"><a href="#cb26-143" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame({<span class="st">'words'</span>:search_tweets,<span class="st">'count'</span>:[<span class="dv">0</span>]<span class="op">*</span><span class="dv">10</span>})</span>
<span id="cb26-144"><a href="#cb26-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-145"><a href="#cb26-145" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, val <span class="kw">in</span> <span class="bu">enumerate</span>(json_files):</span>
<span id="cb26-146"><a href="#cb26-146" aria-hidden="true" tabindex="-1"></a>    open_json <span class="op">=</span> <span class="bu">open</span>(<span class="st">'./'</span><span class="op">+</span>val)</span>
<span id="cb26-147"><a href="#cb26-147" aria-hidden="true" tabindex="-1"></a>    load_json <span class="op">=</span> json.load(open_json)</span>
<span id="cb26-148"><a href="#cb26-148" aria-hidden="true" tabindex="-1"></a>    df_tweet <span class="op">=</span> pd.DataFrame(load_json)</span>
<span id="cb26-149"><a href="#cb26-149" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> word <span class="kw">in</span> search_tweets:</span>
<span id="cb26-150"><a href="#cb26-150" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(df_tweet.text)): </span>
<span id="cb26-151"><a href="#cb26-151" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> word <span class="kw">in</span> df_tweet[<span class="st">'text'</span>][i]:<span class="co"># condition satisfied?</span></span>
<span id="cb26-152"><a href="#cb26-152" aria-hidden="true" tabindex="-1"></a>                df.loc[df[<span class="st">'words'</span>]<span class="op">==</span>word,<span class="st">'count'</span>] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb26-153"><a href="#cb26-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-154"><a href="#cb26-154" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span>
<span id="cb26-155"><a href="#cb26-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-156"><a href="#cb26-156" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> df.sort_values(<span class="st">'count'</span>).plot(x <span class="op">=</span> <span class="st">'words'</span>,y<span class="op">=</span><span class="st">'count'</span>,kind<span class="op">=</span><span class="st">'bar'</span>)</span>
<span id="cb26-157"><a href="#cb26-157" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Frequency of Words'</span>)</span>
<span id="cb26-158"><a href="#cb26-158" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'word'</span>)</span>
<span id="cb26-159"><a href="#cb26-159" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Count'</span>)</span>
<span id="cb26-160"><a href="#cb26-160" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-161"><a href="#cb26-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-162"><a href="#cb26-162" aria-hidden="true" tabindex="-1"></a><span class="fu">### Wikipedia</span></span>
<span id="cb26-163"><a href="#cb26-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-164"><a href="#cb26-164" aria-hidden="true" tabindex="-1"></a>In addition, I used the Wikipedia API to collect the top 10 web pages that appeared on the site when I searched for the word “health insurance”. I saved all the text on this web page into a list called mytext and generated a word cloud poster below. The results are obvious: the most popular words on word cloud are related to insurance and disease.</span>
<span id="cb26-165"><a href="#cb26-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-168"><a href="#cb26-168" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb26-169"><a href="#cb26-169" aria-hidden="true" tabindex="-1"></a>keywords <span class="op">=</span> wikipedia.search(<span class="st">"health insurance"</span>, results<span class="op">=</span><span class="dv">10</span>, suggestion<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb26-170"><a href="#cb26-170" aria-hidden="true" tabindex="-1"></a>my_text <span class="op">=</span> <span class="st">''</span></span>
<span id="cb26-171"><a href="#cb26-171" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> keywords:</span>
<span id="cb26-172"><a href="#cb26-172" aria-hidden="true" tabindex="-1"></a>    page <span class="op">=</span> wikipedia.page(title <span class="op">=</span> k)</span>
<span id="cb26-173"><a href="#cb26-173" aria-hidden="true" tabindex="-1"></a>    content <span class="op">=</span> page.content</span>
<span id="cb26-174"><a href="#cb26-174" aria-hidden="true" tabindex="-1"></a>    my_text <span class="op">+=</span> content</span>
<span id="cb26-175"><a href="#cb26-175" aria-hidden="true" tabindex="-1"></a>    text_file <span class="op">=</span> <span class="bu">open</span>(k<span class="op">+</span><span class="st">'.txt'</span>, <span class="st">"w"</span>)</span>
<span id="cb26-176"><a href="#cb26-176" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> text_file.write(content)</span>
<span id="cb26-177"><a href="#cb26-177" aria-hidden="true" tabindex="-1"></a>    text_file.close()</span>
<span id="cb26-178"><a href="#cb26-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-179"><a href="#cb26-179" aria-hidden="true" tabindex="-1"></a>wordcloud <span class="op">=</span> WordCloud(</span>
<span id="cb26-180"><a href="#cb26-180" aria-hidden="true" tabindex="-1"></a>    width <span class="op">=</span> <span class="dv">3000</span>,</span>
<span id="cb26-181"><a href="#cb26-181" aria-hidden="true" tabindex="-1"></a>    height <span class="op">=</span> <span class="dv">2000</span>, </span>
<span id="cb26-182"><a href="#cb26-182" aria-hidden="true" tabindex="-1"></a>    random_state<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb26-183"><a href="#cb26-183" aria-hidden="true" tabindex="-1"></a>    background_color<span class="op">=</span><span class="st">'salmon'</span>, </span>
<span id="cb26-184"><a href="#cb26-184" aria-hidden="true" tabindex="-1"></a>    colormap<span class="op">=</span><span class="st">'Pastel1'</span>, </span>
<span id="cb26-185"><a href="#cb26-185" aria-hidden="true" tabindex="-1"></a>    collocations<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb26-186"><a href="#cb26-186" aria-hidden="true" tabindex="-1"></a>    stopwords <span class="op">=</span> STOPWORDS).generate(my_text)</span>
<span id="cb26-187"><a href="#cb26-187" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb26-188"><a href="#cb26-188" aria-hidden="true" tabindex="-1"></a>plt.imshow(wordcloud) </span>
<span id="cb26-189"><a href="#cb26-189" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">"off"</span>)</span>
<span id="cb26-190"><a href="#cb26-190" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb26-191"><a href="#cb26-191" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-192"><a href="#cb26-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-193"><a href="#cb26-193" aria-hidden="true" tabindex="-1"></a><span class="fu">### Record Data</span></span>
<span id="cb26-194"><a href="#cb26-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-195"><a href="#cb26-195" aria-hidden="true" tabindex="-1"></a>For record data, I will use two datasets from the RAND Health Insurance Experiment (HIE). One contains demographic information about the subjects in the study and also health variables (outcomes) both before and after the experiment. The other file has information about health care spending. Both dataset consists of 319 variables and 20203 observations. From 1974 to 1982, the RAND Health Insurance Experiment followed 3,958 people aged 14 to 61 from six areas of the country. The participants were randomly assigned to one of 14 insurance plans that had a variety of provisions related to cost-sharing. Besides the variable "plantype", which identifies the assigned insurance group of each individual, the variables that I am going to use for this project are displayed below: </span>
<span id="cb26-196"><a href="#cb26-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-197"><a href="#cb26-197" aria-hidden="true" tabindex="-1"></a>|Variable   |Definition   |</span>
<span id="cb26-198"><a href="#cb26-198" aria-hidden="true" tabindex="-1"></a>|---|---|</span>
<span id="cb26-199"><a href="#cb26-199" aria-hidden="true" tabindex="-1"></a>|female   |Female   |</span>
<span id="cb26-200"><a href="#cb26-200" aria-hidden="true" tabindex="-1"></a>|blackhisp   |Nonwhite   |</span>
<span id="cb26-201"><a href="#cb26-201" aria-hidden="true" tabindex="-1"></a>|age   |Age   |</span>
<span id="cb26-202"><a href="#cb26-202" aria-hidden="true" tabindex="-1"></a>|educper   |Education   |</span>
<span id="cb26-203"><a href="#cb26-203" aria-hidden="true" tabindex="-1"></a>|income1cpi   |Family income   |</span>
<span id="cb26-204"><a href="#cb26-204" aria-hidden="true" tabindex="-1"></a>|hosp   |Hospitalized last year   |</span>
<span id="cb26-205"><a href="#cb26-205" aria-hidden="true" tabindex="-1"></a>|ghindx   |General Health Index (before)   |</span>
<span id="cb26-206"><a href="#cb26-206" aria-hidden="true" tabindex="-1"></a>|cholest   |Cholesterol (mg/dl) (before)   |</span>
<span id="cb26-207"><a href="#cb26-207" aria-hidden="true" tabindex="-1"></a>|systol   |Systolic blood pressure (mm Hg) (before)   |</span>
<span id="cb26-208"><a href="#cb26-208" aria-hidden="true" tabindex="-1"></a>|mhi   |Mental Health Index (before)   |</span>
<span id="cb26-209"><a href="#cb26-209" aria-hidden="true" tabindex="-1"></a>|ghindxx   |General Health Index (after)   |</span>
<span id="cb26-210"><a href="#cb26-210" aria-hidden="true" tabindex="-1"></a>|cholestx   |Cholesterol (mg/dl) (after)   |</span>
<span id="cb26-211"><a href="#cb26-211" aria-hidden="true" tabindex="-1"></a>|systolx   |Systolic blood pressure (mm Hg) (after)   |</span>
<span id="cb26-212"><a href="#cb26-212" aria-hidden="true" tabindex="-1"></a>|mhix   |Mental Health Index (after)   |</span>
<span id="cb26-213"><a href="#cb26-213" aria-hidden="true" tabindex="-1"></a></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>